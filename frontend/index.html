<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ongao's Poker Lab ğŸš€</title>

<!-- ç°ä»£æ„Ÿå­—ä½“ -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..900&display=swap" rel="stylesheet">

<!-- ä¸»é¢˜æ ·å¼ï¼ˆçº¯é™æ€ï¼šä¸å†ç”¨ url_forï¼‰ -->
<link rel="stylesheet" href="./style.css">

<style>
  :root{--grad1:#60a5fa;--grad2:#a78bfa}
  body{font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .container { max-width: 960px; margin: 0 auto; padding: 28px 16px; }
  h1 { margin: 0 0 6px 0; }
  .sub { color: #6b7280; margin: 0 0 16px 0; }
  .card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; margin: 12px 0; }
  .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
  .row > * { flex: 1 1 180px; }
  .input-mini { width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 14px; }
  .btn { padding: 10px 14px; border: 1px solid #d1d5db; background: #111827; color: #fff; border-radius: 10px; cursor: pointer; font-weight: 600; }
  .btn.secondary { background: #fff; color: #111827; }
  .btn:disabled { opacity: .6; cursor: not-allowed; }
  .help { font-size: 12px; color: #6b7280; }
  .output { white-space: pre-wrap; background: #0b1020; color: #e5e7eb; padding: 12px; border-radius: 10px; min-height: 48px; }
  .bar-wrap { background: #f3f4f6; border-radius: 12px; overflow: hidden; height: 14px; }
  .bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--grad1), var(--grad2)); transition: width .4s ease; }
  .pair { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .stack { display: grid; gap: 8px; }
  .muted { color: #6b7280; }
  .danger { color: #b91c1c; }
  .ok { color: #065f46; }
  .loading { animation: pulse 1.1s infinite ease-in-out; }
  @keyframes pulse { 0%{opacity:.55} 50%{opacity:1} 100%{opacity:.55} }
  .inline { display: inline-flex; gap: 8px; align-items: center; }
  .pill { font-size: 12px; padding: 4px 8px; border: 1px solid #e5e7eb; border-radius: 999px; }
  .kvs { display: grid; grid-template-columns: 160px 1fr; gap: 8px; }
  code.inline { background: #f3f4f6; padding:2px 6px; border-radius:6px;}

  .is-invalid { border-color:#dc3545 !important; box-shadow:0 0 0 .2rem rgba(220,53,69,.12) !important; }
  .help-row { display:flex; gap:10px; align-items:baseline; flex-wrap: wrap; margin-top:4px; }
  .help-preview { color:#6b7280; font-size:12px; }
  .help-error { color:#b91c1c; font-size:12px; }
  #dup-alert { display:none }

  .progress-card{border:1px solid #e5e7eb;border-radius:14px;padding:14px;margin:12px 0;display:none}
  .progress-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .progress-sub{color:#6b7280}
  .bar-wrap.x{height:14px}
  .bar.x{height:100%;width:0%;background:linear-gradient(90deg,var(--grad1),var(--grad2));transition:width .15s ease}

  /* é¡¶éƒ¨å‘Šè­¦æ¡ï¼ˆAPI_BASE æœªè®¾ç½®æ—¶æ˜¾ç¤ºï¼‰ */
  .top-alert{display:none;background:#fee2e2;color:#991b1b;padding:8px 12px;text-align:center}
</style>
</head>

<body>
  <!-- è‹¥ API_BASE ç¼ºå¤±ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºçº¢è‰²å‘Šè­¦æ¡ -->
  <div id="topAlert" class="top-alert"></div>

  <header class="nav">
    <div class="nav-inner">
      <div class="brand">Ongao's Poker Lab</div>
      <button id="themeBtn" class="theme-toggle" type="button">â˜¾/â˜€ï¸</button>
    </div>
  </header>

  <main class="container">
    <h1>Ongao's Poker Lab ğŸš€</h1>
    <p class="sub">è¾“å…¥æ‰‹ç‰Œä¸å…¬å…±ç‰Œï¼Œä¸€é”®è·å–èƒœç‡ï¼Œå¹¶åŸºäº Pot Odds ç»™å‡ºä¸‹æ³¨å»ºè®®ï¼›è‹¥åç«¯æä¾› LLM æ–‡æ¡ˆï¼Œåˆ™æ˜¾ç¤ºæ›´è¯¦ç»†çš„ç­–ç•¥ã€‚</p>

    <!-- è½»é‡è‡ªæ£€å·¥å…·æ¡ -->
    <section class="card" style="display:flex;align-items:center;gap:10px;">
      <div class="pill">API_BASE: <code id="apiBaseText">â€”</code></div>
      <button class="btn secondary" type="button" onclick="window.__PING_HEALTH__ && window.__PING_HEALTH__()">å¿«é€Ÿæµ‹è¯• /health</button>
    </section>

    <!-- è¾“å…¥åŒº -->
    <section class="card">
      <h2>è¾“å…¥ç‰Œé¢</h2>
      <div class="row">
        <div class="stack">
          <label>æ‰‹ç‰Œï¼ˆ2 å¼ ï¼Œæ ¼å¼å¦‚ <code class="inline">Ah</code>ã€<code class="inline">Kd</code>ï¼‰</label>
          <div class="pair">
            <input id="hole1" class="input-mini" maxlength="2" placeholder="å¦‚ Ah">
            <input id="hole2" class="input-mini" maxlength="2" placeholder="å¦‚ Kd">
          </div>
          <div class="help-row">
            <div id="hero_preview" class="help-preview"></div>
            <div id="hero_error" class="help-error"></div>
          </div>
        </div>

        <div class="stack" style="flex: 2 1 360px;">
          <label>å…¬å…±ç‰Œï¼ˆ0â€“5 å¼ ï¼Œä»»æ„é˜¶æ®µè¾“å…¥å³å¯ï¼‰</label>
          <div class="row">
            <input id="b1" class="input-mini" maxlength="2" placeholder="ç¿»ç‰Œ1">
            <input id="b2" class="input-mini" maxlength="2" placeholder="ç¿»ç‰Œ2">
            <input id="b3" class="input-mini" maxlength="2" placeholder="ç¿»ç‰Œ3">
            <input id="b4" class="input-mini" maxlength="2" placeholder="è½¬ç‰Œ">
            <input id="b5" class="input-mini" maxlength="2" placeholder="æ²³ç‰Œ">
          </div>
          <div class="help-row">
            <div id="board_preview" class="help-preview"></div>
            <div id="board_error" class="help-error"></div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="stack">
          <label>å½©æ± å¤§å°ï¼ˆå¯é€‰ï¼Œå•ä½åŒä¸‹æ³¨ï¼‰</label>
          <input id="pot" class="input-mini" type="number" min="0" step="0.01" placeholder="å¦‚ 10">
        </div>
        <div class="stack">
          <label>ä½ éœ€è¦è·Ÿæ³¨çš„é‡‘é¢ï¼ˆå¯é€‰ï¼‰</label>
          <input id="call" class="input-mini" type="number" min="0" step="0.01" placeholder="å¦‚ 3">
        </div>
        <div class="stack">
          <label>&nbsp;</label>
          <div class="inline">
            <button id="btn-run" class="btn" type="button">è®¡ç®—èƒœç‡</button>
            <button id="btn-reset" class="btn secondary" type="button">é‡ç½®</button>
            <button id="btn-sample" className="btn secondary" type="button">ç¤ºä¾‹å¡«å……</button>
          </div>
        </div>
      </div>
      <div id="dup-alert" class="alert alert-danger mt-2"></div>
      <p class="help">ç‰Œé¢æ ¼å¼ï¼š<code class="inline">2-9,T,J,Q,K,A</code> + <code class="inline">s/h/d/c</code>ï¼ˆâ™ /â™¥/â™¦/â™£ï¼‰ã€‚ä¾‹å¦‚ï¼š<code class="inline">As</code>ã€<code class="inline">Th</code>ã€<code class="inline">7d</code>ã€<code class="inline">9c</code>ã€‚</p>
    </section>

    <!-- å®æ—¶è¿›åº¦ï¼ˆSSEï¼‰ -->
    <section id="progressPanel" class="progress-card">
      <div class="progress-title">
        <div><b id="stageText">å‡†å¤‡ä¸­â€¦</b></div>
        <div class="progress-sub"><span id="etaText"></span></div>
      </div>
      <div class="bar-wrap x">
        <div id="bar" class="bar x"></div>
      </div>
      <div class="progress-sub" style="margin-top:6px;">
        <span id="pctText">0%</span>
        <span id="streetText" class="ms-3"></span>
      </div>
    </section>

    <!-- ç»“æœåŒº -->
    <section class="card">
      <h2>èƒœç‡ï¼ˆEquityï¼‰</h2>
      <div class="kvs">
        <div class="muted">æˆ‘æ–¹è·èƒœæ¦‚ç‡</div>
        <div><strong id="equity-text">â€”</strong></div>
      </div>
      <div class="bar-wrap" style="margin:10px 0;">
        <div id="equity-bar" class="bar"></div>
      </div>
      <div class="kvs">
        <div class="muted">å¹³å±€æ¦‚ç‡</div><div id="tie-text">â€”</div>
        <div class="muted">å¤±è´¥æ¦‚ç‡</div><div id="lose-text">â€”</div>
      </div>
    </section>

    <section class="card">
      <h2>ç­–ç•¥å»ºè®®</h2>
      <div class="kvs" style="margin-bottom:8px;">
        <div class="muted">Pot Oddsï¼ˆè‡ªåŠ¨ç®—ï¼‰</div>
        <div id="odds-text">â€”</div>
      </div>
      <div id="advice" class="output">// è¿™é‡Œå°†æ˜¾ç¤ºæ¥è‡ªåç«¯çš„ LLM å»ºè®®ï¼›å¦‚æ— ï¼Œåˆ™æ ¹æ® equity ä¸ pot odds ç»™å‡ºå…œåº•å»ºè®®ã€‚</div>
      <div class="help" style="margin-top:8px">
        å…œåº•è§„åˆ™ï¼šå½“ <code class="inline">equity â‰¥ pot_odds</code> å€¼å¾—è·Ÿæ³¨ï¼›ä¼˜åŠ¿è¾ƒå¤§ä¸”å¯¹æ‰‹å¼ƒç‰Œç‡å¯è§‚æ—¶å¯åŠ æ³¨ï¼ˆå»ºè®®ä¸‹æ³¨é‡ï¼šå½©æ± çš„ 40%â€“70%ï¼‰ã€‚
      </div>
    </section>

    <footer class="muted" style="margin-top:16px;">
      <small>åç«¯ API é€šè¿‡ <code>window.API_BASE</code> æŒ‡å®šï¼›è®¡ç®—æµç¨‹ï¼š<code>POST /start</code> â†’ <code>EventSource /stream/&lt;task_id&gt;</code>ã€‚</small>
    </footer>
  </main>

  <!-- 1) å¿…é¡»ï¼šå…ˆåŠ è½½åç«¯åŸŸåé…ç½® -->
  <script src="./config.js"></script>

  <!-- 1.1 é˜²å‘†ï¼šè‹¥æ²¡è®¾ç½® API_BASEï¼Œç»™å‡ºå‘Šè­¦ -->
  <script>
    (function(){
      const base = (window.API_BASE || '').trim();
      const warn = document.getElementById('topAlert');
      const pill = document.getElementById('apiBaseText');
      if (pill) pill.textContent = base || 'ï¼ˆæœªè®¾ç½®ï¼‰';
      if (!base) {
        warn.style.display = 'block';
        warn.textContent = 'âš ï¸ æœªæ£€æµ‹åˆ° API_BASEï¼Œè¯·å…ˆåœ¨ config.js è®¾ç½®åç«¯åŸŸåï¼ˆå¦‚ https://poker-assistant.onrender.comï¼‰ã€‚';
      }
      // æä¾›ä¸€ä¸ª /health å¿«é€Ÿè‡ªæ£€ï¼Œä¸ä¾èµ– app.js
      window.__PING_HEALTH__ = async function(){
        const b = (window.API_BASE || '').replace(/\/+$/,'');
        if (!b) return alert('API_BASE æœªè®¾ç½®ï¼è¯·å…ˆåœ¨ config.js é…ç½®ã€‚');
        try{
          const r = await fetch(`${b}/health`);
          const t = await r.text();
          alert(r.ok ? `âœ… /health æ­£å¸¸ï¼š\n${t}` : `âŒ /health å“åº”å¼‚å¸¸ï¼š${r.status} ${r.statusText}\n${t}`);
        }catch(e){ alert('âŒ /health ç½‘ç»œé”™è¯¯ï¼š' + e); }
      };
    })();
  </script>

  <!-- 2) ä½ çš„ä¸»é€»è¾‘ï¼ˆä¼šä½¿ç”¨ window.API_BASE è¯·æ±‚ /start ä¸ /streamï¼‰ -->
  <script src="./app.js" defer></script>

  <!-- 3) ä¸»é¢˜åˆ‡æ¢ -->
  <script>
    (function(){
      const html = document.documentElement;
      const btn = document.getElementById('themeBtn');
      const set = m => { html.classList.toggle('light', m==='light'); localStorage.setItem('theme', m); }
      const current = localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
      set(current);
      btn && (btn.onclick = () => set(html.classList.contains('light') ? 'dark' : 'light'));
    })();
  </script>

  <!-- 4) å‰ç«¯å®æ—¶æ ¡éªŒï¼ˆä½ åŸæœ‰é€»è¾‘ï¼Œæœªæ”¹åŠ¨ï¼‰ -->
  <script>
  /* ä½ çš„æ ¡éªŒè„šæœ¬ï¼ˆåŸæ ·ä¿ç•™ï¼‰ â€”â€” ä¸ºèŠ‚çœç¯‡å¹…ï¼Œè¿™é‡Œç•¥ã€‚æŠŠä½ å‘æ¥çš„é‚£æ®µåŸæ ·æ”¾å›è¿™é‡Œå³å¯ */
  </script>
</body>
</html>
